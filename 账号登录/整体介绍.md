## 核心目的
- 身份认证：确认用户声称的身份（如用户名、手机号、邮箱）是否真实有效。
- 授权访问：在认证成功后，授予用户访问其权限范围内资源和功能的凭证
- 安全管理：保护用户凭证（密码等）的安全，防止未授权访问和数据泄露
- 账户管理：提供注册、信息维护（修改密码、绑定/解绑手机/邮箱）、账户注销等功能
- 用户体验：提供便捷、安全的登录方式，并管理用户会话状态

## 核心知识体系
### 1. 账户模型 (Account Model)
*   **用户标识：** 唯一标识用户的字段（User ID/UUID），通常系统内部使用。
*   **登录凭证：**
    *   **用户名/邮箱/手机号：** 用户用于声明身份的公开标识。
    *   **密码：** 最传统的秘密凭证。**核心知识：密码安全存储（加盐哈希算法如 bcrypt, scrypt, Argon2, PBKDF2）**。
    *   **其他凭证：** 生物特征（指纹、面部）、安全密钥（FIDO2/WebAuthn）、一次性密码（OTP）。
*   **用户信息：** 昵称、头像、个人资料等。
*   **账户状态：** 正常、未激活、冻结、注销等。
*   **关联信息：** 绑定的手机号、邮箱、第三方账号（用于 OAuth 登录）、安全设备等。

### 2. 认证 (Authentication - AuthN)
*   **目的：** 验证用户身份“**你是谁？**”。
*   **主要方式：**
    *   **基于密码：** 最基础，挑战在于安全存储和传输。
    *   **多因素认证：**
        *   **MFA (Multi-Factor Authentication)：** 结合两种或以上不同类型的凭证：
            *   **知识因素 (Something you know)：** 密码、PIN、安全问题答案。
            *   **持有因素 (Something you have)：** 手机（短信/APP验证码）、硬件令牌、安全密钥。
            *   **固有因素 (Something you are)：** 指纹、面部、虹膜、声纹。
        *   **2FA (Two-Factor Authentication)：** MFA 的一种特例，使用两种因素。
    *   **无密码认证：**
        *   **基于邮件/短信链接：** 点击链接完成登录。
        *   **基于邮件/短信验证码：** 输入发送到邮箱/手机的验证码。
        *   **基于生物特征：** 如 FaceID, TouchID。
        *   **基于安全密钥：** FIDO2/WebAuthn 标准，利用公钥密码学。
    *   **单点登录：**
        *   **SSO (Single Sign-On)：** 用户在一个系统登录后，可以访问其他信任的关联系统而无需再次登录。**核心协议：SAML, OpenID Connect (基于 OAuth 2.0)**。
    *   **社交登录：**
        *   **OAuth 2.0 / OpenID Connect：** 用户使用第三方平台（微信、QQ、Google、Facebook）账号登录你的应用。你的应用获得授权后，向第三方平台请求用户身份信息。**重点理解授权流程、授权码模式、令牌获取与验证、用户信息端点**。
*   **认证流程设计：** 登录接口设计、错误处理（区分用户名不存在、密码错误、账户被锁定等）、验证码（防暴力破解）、风控策略（异地登录、异常尝试检测）。

### 3. 授权 (Authorization - AuthZ)
*   **目的：** 确定认证成功的用户“**你能做什么？**”。
*   **核心概念：**
    *   **权限：** 对特定资源（如文件、API 端点）进行特定操作（读、写、删除）的能力。
    *   **角色：** 一组权限的集合，方便分配给用户。
*   **主流模型：**
    *   **RBAC (Role-Based Access Control)：** 用户 -> 角色 -> 权限。最常用，易于管理。
    *   **ABAC (Attribute-Based Access Control)：** 基于用户属性、资源属性、环境属性（时间、位置）等动态计算权限。更灵活，更复杂。
    *   **ACL (Access Control List)：** 直接在资源上指定哪些用户/角色有哪些权限。适用于资源较少的场景。
*   **授权决策点：** 在访问受保护资源（如API、页面）前进行权限校验。
    

### 4. 会话管理 (Session Management)
*   **目的：** 在用户通过认证后，维持其登录状态，避免每次请求都需要重新认证。
*   **核心机制：**
    *   **Session-Based (服务器端会话)：**
        *   登录成功后在服务器创建 Session 对象（存储用户ID、权限等）。
        *   将唯一的 Session ID 返回给客户端（通常通过 Cookie `JSESSIONID`）。
        *   客户端后续请求携带此 Session ID。
        *   服务器根据 Session ID 查找对应的 Session 数据，确认用户状态。
        *   **挑战：** 分布式/集群环境下的 Session 共享（解决方案：Session Replication, Sticky Session, Centralized Session Store - Redis/Memcached）。
    *   **Token-Based (令牌)：**
        *   登录成功后，服务器生成一个令牌（包含用户标识、有效期等信息）返回给客户端。
        *   客户端后续请求在 `Authorization` Header 中携带此令牌（通常为 `Bearer <token>`）。
        *   服务器验证令牌的有效性（签名、有效期）并解析出用户信息。
        *   **主流令牌：**
            *   **JWT：** JSON Web Token。自包含、可验证、可携带信息。**核心知识：结构（Header.Payload.Signature）、签名算法（HMAC, RSA, ECDSA）、优缺点（无状态 vs 难撤销）。**
            *   **Opaque Token：** 不透明令牌，服务器端存储相关信息，客户端只持有令牌引用。需要服务器端存储查询，但易于撤销。
        *   **Token 管理：** 令牌刷新机制（Refresh Token）、令牌撤销机制（黑名单）。
*   **会话安全：**
    *   **Cookie 安全属性：** `Secure` (仅 HTTPS)、`HttpOnly` (防 XSS 窃取)、`SameSite` (防 CSRF)。
    *   **令牌安全：** 防止泄露、使用 HTTPS、合理设置有效期、提供撤销机制。
    *   **会话超时：** 设置合理的会话空闲超时和绝对超时时间。
  
### 5. 安全防护
*   **密码安全：**
    *   **存储：** 绝对禁止明文存储！使用强加盐哈希算法（bcrypt, scrypt, Argon2）。
    *   **传输：** 必须使用 HTTPS。
    *   **策略：** 密码复杂度要求、定期修改提示（非强制）、禁止常见弱密码。
*   **防暴力破解：**
    *   验证码（图片、短信、行为验证码如滑块）。
    *   登录尝试次数限制（IP/账号维度）、失败锁定（临时冻结）。
*   **防凭证填充：** 使用验证码、行为分析、风险控制。
*   **防中间人攻击：** 强制 HTTPS（HSTS）。
*   **防跨站请求伪造：** CSRF Token（同步令牌模式）、SameSite Cookie。
*   **防跨站脚本攻击：** 输入输出编码/过滤、CSP 策略、HttpOnly Cookie。
*   **安全审计：** 记录关键操作日志（登录成功/失败、密码修改、敏感操作）。
*   **数据泄露防护：** 敏感信息脱敏、加密存储（如手机号、邮箱）。

### 6. 相关功能与服务
*   **注册：** 用户创建流程、邮箱/手机验证、邀请码、协议同意。
*   **账户管理：**
    *   修改密码（需验证旧密码）。
    *   找回密码（通过邮箱/手机重置，需严格安全验证）。
    *   绑定/解绑手机/邮箱/第三方账号。
    *   账户注销/冻结（数据合规处理）。
    *   账户信息修改。
*   **设备管理：** 查看登录设备、信任设备、强制下线。
*   **通知：** 登录成功/失败通知、异地登录提醒、安全设置变更提醒。

### 7. 架构与基础设施
*   **微服务/分布式架构：** 认证授权服务独立部署（Auth Service），通过 API 网关统一处理认证。
*   **数据库：** 存储用户信息、密码哈希、Session（如果不用 Redis）等。
*   **缓存：** Redis/Memcached 存储 Session、Token 黑名单、验证码、登录限制计数等。
*   **消息队列：** 异步处理登录日志、发送通知等。
*   **密钥管理：** 安全存储用于 JWT 签名、数据加密的密钥（HSM/KMS）。 